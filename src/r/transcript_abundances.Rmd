---
title: "transcript_abundances"
author: "Tanvi Ingle"
date: "8/20/2021"
output: html_document
---

## Objective

Here I create a function to plot transcript abundances from phix174 model outputs

### Get libraries
```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(cowplot)
```

### General function to plot normalized transcript abundances
```{r}
plot_abundances <- function(basedir, filename, timestamp){
fig <- read_tsv(paste0(basedir, filename)) %>% 
       mutate(time = round(time)) %>% 
       filter(time == timestamp) %>% 
       filter(!str_detect(species, '__|bound|ecoli|promoter')) %>% 
       mutate(normalized = transcript/transcript[1]) %>% 
       mutate(species = factor(species, c("gene_A", "gene_A*", "gene_B",
                                         "gene_K", "gene_C", "gene_D",
                                         "gene_E", "gene_J", "gene_F",
                                         "gene_G", "gene_H"),
                                       c("A", "A*", "B", "K",
                                         "C", "D", "E", "J",
                                         "F", "G", "H"))) %>% 
       ggplot(aes(x=species, y=normalized, fill = species)) +
       geom_bar(stat="identity") + 
       geom_hline(yintercept=1, linetype="dashed", color = "red") + 
       geom_hline(yintercept=6, linetype="dashed", color = "red") + 
       geom_hline(yintercept=17, linetype="dashed", color = "red") + 
       geom_hline(yintercept=11, linetype="dashed", color = "red") + 
       geom_hline(yintercept=5, linetype="dashed", color = "red") + 
       cowplot::theme_cowplot(12) +
       theme(legend.position = "none") 

return(fig)
}

```


### Set directories & Parameters
```{r}
basedir = "/Users/tanviingle/Documents/Wilke/phix174/output/opt_test/"
filename = "gen_0.tsv"
timestamp = 2400

#plot_abundances(basedir, "gen_0.tsv", timestamp)
plot_abundances(basedir, "gen_0.tsv", 1200)
plot_abundances(basedir, "gen_0.tsv", 1400)
plot_abundances(basedir, "gen_0.tsv", 2400)
#plot_abundances(basedir, "gen_1.tsv", timestamp)
#plot_abundances(basedir, "gen_1.tsv", 1200)
```









